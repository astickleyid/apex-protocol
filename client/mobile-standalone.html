<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Apex Protocol</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
/* Loading Animation - Apex Protocol */
#apex-loader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: linear-gradient(135deg, #0c0a09 0%, #1c1917 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
}

#apex-loader.hidden {
    opacity: 0;
    transform: scale(1.1);
    pointer-events: none;
}

.loader-icon {
    width: 120px;
    height: 120px;
    margin-bottom: 40px;
    position: relative;
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

.loader-icon svg {
    width: 100%;
    height: 100%;
    filter: drop-shadow(0 0 30px rgba(249, 115, 22, 0.4));
}

.loader-ring {
    width: 140px;
    height: 140px;
    border: 3px solid transparent;
    border-top-color: #f97316;
    border-right-color: #f97316;
    border-radius: 50%;
    animation: spin 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
    position: absolute;
    top: -10px;
    left: -10px;
}

.loader-ring-2 {
    width: 160px;
    height: 160px;
    border: 2px solid transparent;
    border-bottom-color: #ea580c;
    border-left-color: #ea580c;
    border-radius: 50%;
    animation: spin-reverse 2s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
    position: absolute;
    top: -20px;
    left: -20px;
}

.loader-text {
    color: #f97316;
    font-family: 'JetBrains Mono', monospace;
    font-size: 14px;
    font-weight: 700;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    animation: glow 2s ease-in-out infinite;
}

.loader-dots {
    display: inline-block;
    width: 30px;
    text-align: left;
}

.loader-dots::after {
    content: '';
    animation: dots 1.5s steps(4, end) infinite;
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
        opacity: 1;
    }
    50% {
        transform: scale(1.05);
        opacity: 0.8;
    }
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
        opacity: 0.8;
    }
    50% {
        opacity: 1;
    }
    100% {
        transform: rotate(360deg);
        opacity: 0.8;
    }
}

@keyframes spin-reverse {
    0% {
        transform: rotate(360deg);
        opacity: 0.5;
    }
    50% {
        opacity: 0.8;
    }
    100% {
        transform: rotate(0deg);
        opacity: 0.5;
    }
}

@keyframes glow {
    0%, 100% {
        text-shadow: 0 0 10px rgba(249, 115, 22, 0.5),
                     0 0 20px rgba(249, 115, 22, 0.3);
    }
    50% {
        text-shadow: 0 0 20px rgba(249, 115, 22, 0.8),
                     0 0 30px rgba(249, 115, 22, 0.5),
                     0 0 40px rgba(249, 115, 22, 0.3);
    }
}

@keyframes dots {
    0%, 20% {
        content: '';
    }
    40% {
        content: '.';
    }
    60% {
        content: '..';
    }
    80%, 100% {
        content: '...';
    }
}
/* Complete Mobile Redesign - Professional & Feature-Complete */

@media (max-width: 768px) {
    /* === CORE LAYOUT === */
    body {
        padding-bottom: 80px !important;
        overflow-x: hidden;
    }
    
    /* Hide desktop elements */
    nav.h-14,
    section.h-64,
    aside.w-1\/3,
    main.flex-grow,
    section.flex-grow.flex {
        display: none !important;
    }
    
    /* === MOBILE NAVIGATION === */
    .mobile-nav {
        display: flex !important;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 80px;
        background: linear-gradient(to top, #0c0a09, #1c1917);
        border-top: 2px solid #44403c;
        z-index: 9999;
        justify-content: space-around;
        align-items: center;
        padding: 0.5rem;
        box-shadow: 0 -8px 24px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(10px);
    }
    
    .mobile-nav-item {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0.35rem;
        padding: 0.75rem 0.5rem;
        color: #57534e;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        border-radius: 12px;
        position: relative;
        min-height: 64px;
    }
    
    .mobile-nav-item.active {
        color: #f97316;
        background: rgba(249, 115, 22, 0.15);
        transform: translateY(-3px);
    }
    
    .mobile-nav-item:active {
        transform: scale(0.92);
    }
    
    .mobile-nav-icon {
        width: 28px;
        height: 28px;
        stroke: currentColor;
        fill: none;
        stroke-width: 2.5;
        stroke-linecap: round;
        stroke-linejoin: round;
        transition: transform 0.2s;
    }
    
    .mobile-nav-item.active .mobile-nav-icon {
        transform: scale(1.1);
    }
    
    .mobile-nav-label {
        font-size: 0.7rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-family: 'JetBrains Mono', monospace;
    }
    
    .mobile-nav-item.active::before {
        content: '';
        position: absolute;
        top: 8px;
        width: 6px;
        height: 6px;
        background: #f97316;
        border-radius: 50%;
        box-shadow: 0 0 12px rgba(249, 115, 22, 0.8);
        animation: pulse 2s infinite;
    }
    
    /* === MOBILE VIEWS === */
    .mobile-view {
        display: none;
        width: 100%;
        height: calc(100vh - 80px);
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        background: #0c0a09;
    }
    
    .mobile-view.active {
        display: block;
    }
    
    /* Better scrollbars */
    .mobile-view::-webkit-scrollbar {
        width: 6px;
    }
    
    .mobile-view::-webkit-scrollbar-track {
        background: #1c1917;
    }
    
    .mobile-view::-webkit-scrollbar-thumb {
        background: #44403c;
        border-radius: 3px;
    }
    
    .mobile-view::-webkit-scrollbar-thumb:hover {
        background: #f97316;
    }
    
    /* === IDEAS VIEW === */
    .mobile-ideas-header {
        position: sticky;
        top: 0;
        z-index: 100;
        background: linear-gradient(135deg, #1c1917 0%, #0c0a09 100%);
        padding: 1.5rem 1rem 1rem;
        border-bottom: 2px solid #292524;
        backdrop-filter: blur(10px);
    }
    
    .mobile-ideas-title {
        color: #f97316;
        font-size: 1.75rem;
        font-weight: 700;
        letter-spacing: 0.05em;
        margin-bottom: 0.5rem;
        font-family: 'Inter', sans-serif;
    }
    
    .mobile-ideas-subtitle {
        color: #78716c;
        font-size: 0.75rem;
        font-family: 'JetBrains Mono', monospace;
        text-transform: uppercase;
        letter-spacing: 0.1em;
    }
    
    .mobile-ideas-list {
        padding: 1rem;
    }
    
    .mobile-idea-card {
        background: linear-gradient(135deg, #1c1917 0%, #292524 100%);
        border: 1px solid #44403c;
        border-radius: 16px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-left: 4px solid transparent;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .mobile-idea-card:active {
        transform: scale(0.97);
        border-left-color: #f97316;
        background: linear-gradient(135deg, #292524 0%, #1c1917 100%);
        box-shadow: 0 8px 24px rgba(249, 115, 22, 0.2);
    }
    
    .mobile-idea-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.75rem;
    }
    
    .mobile-idea-rank {
        color: #f97316;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.85rem;
        font-weight: 700;
        background: rgba(249, 115, 22, 0.1);
        padding: 0.25rem 0.75rem;
        border-radius: 8px;
        border: 1px solid rgba(249, 115, 22, 0.2);
    }
    
    .mobile-idea-value {
        color: #a8a29e;
        font-size: 0.75rem;
        font-family: 'JetBrains Mono', monospace;
        font-weight: 600;
    }
    
    .mobile-idea-name {
        color: #fff;
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        line-height: 1.3;
    }
    
    .mobile-idea-tagline {
        color: #d6d3d1;
        font-size: 0.9rem;
        line-height: 1.5;
    }
    
    /* === DETAIL VIEW === */
    .mobile-detail-header {
        position: sticky;
        top: 0;
        z-index: 100;
        background: linear-gradient(135deg, #1c1917 0%, #0c0a09 100%);
        padding: 1.5rem 1rem;
        border-bottom: 2px solid #292524;
        backdrop-filter: blur(10px);
    }
    
    .mobile-detail-back {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #f97316;
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 1rem;
        background: none;
        border: none;
        padding: 0;
        cursor: pointer;
    }
    
    .mobile-detail-back:active {
        transform: translateX(-4px);
    }
    
    .mobile-detail-content {
        padding: 1.5rem 1rem;
    }
    
    .mobile-detail-section {
        background: linear-gradient(135deg, #1c1917 0%, #292524 100%);
        border: 1px solid #44403c;
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
    
    .mobile-detail-label {
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-bottom: 0.75rem;
        display: block;
        font-family: 'JetBrains Mono', monospace;
    }
    
    .mobile-detail-text {
        color: #d6d3d1;
        line-height: 1.7;
        font-size: 0.95rem;
    }
    
    .mobile-blueprint-item {
        background: #0c0a09;
        border: 1px solid #292524;
        border-left: 3px solid #f97316;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.75rem;
    }
    
    .mobile-blueprint-phase {
        color: #f97316;
        font-size: 0.7rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        font-family: 'JetBrains Mono', monospace;
    }
    
    .mobile-blueprint-text {
        color: #d6d3d1;
        font-size: 0.9rem;
        line-height: 1.5;
    }
    
    /* === TABS IN DETAIL VIEW === */
    .mobile-detail-tabs {
        display: flex;
        gap: 0.5rem;
        padding: 1rem;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        background: #0c0a09;
        border-bottom: 1px solid #292524;
        position: sticky;
        top: 0;
        z-index: 99;
    }
    
    .mobile-detail-tab {
        padding: 0.75rem 1.25rem;
        background: #1c1917;
        border: 1px solid #44403c;
        border-radius: 8px;
        color: #78716c;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        white-space: nowrap;
        cursor: pointer;
        transition: all 0.2s;
        font-family: 'JetBrains Mono', monospace;
    }
    
    .mobile-detail-tab.active {
        background: #f97316;
        color: #fff;
        border-color: #f97316;
    }
    
    .mobile-detail-tab:active {
        transform: scale(0.95);
    }
    
    /* === NEW OPERATION VIEW === */
    .mobile-new-op {
        padding: 1.5rem 1rem;
    }
    
    .mobile-new-header {
        margin-bottom: 2rem;
    }
    
    .mobile-new-title {
        color: #f97316;
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .mobile-new-subtitle {
        color: #78716c;
        font-size: 0.85rem;
    }
    
    .mobile-form-group {
        margin-bottom: 1.75rem;
    }
    
    .mobile-form-label {
        color: #f97316;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        margin-bottom: 0.75rem;
        display: block;
        letter-spacing: 0.1em;
        font-family: 'JetBrains Mono', monospace;
    }
    
    .mobile-form-input,
    .mobile-form-select,
    .mobile-form-textarea {
        width: 100%;
        background: #1c1917;
        border: 2px solid #44403c;
        border-radius: 12px;
        padding: 1rem;
        color: #fff;
        font-size: 1rem;
        transition: all 0.2s;
        font-family: 'Inter', sans-serif;
    }
    
    .mobile-form-textarea {
        min-height: 120px;
        resize: vertical;
    }
    
    .mobile-form-input:focus,
    .mobile-form-select:focus,
    .mobile-form-textarea:focus {
        outline: none;
        border-color: #f97316;
        box-shadow: 0 0 0 4px rgba(249, 115, 22, 0.15);
        background: #0c0a09;
    }
    
    .mobile-submit-btn {
        width: 100%;
        background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%);
        color: white;
        font-weight: 700;
        padding: 1.25rem;
        border-radius: 12px;
        font-size: 1.05rem;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        box-shadow: 0 8px 24px rgba(234, 88, 12, 0.4);
        transition: all 0.3s;
        border: none;
        cursor: pointer;
        font-family: 'JetBrains Mono', monospace;
    }
    
    .mobile-submit-btn:active {
        transform: translateY(2px);
        box-shadow: 0 4px 12px rgba(234, 88, 12, 0.3);
    }
    
    /* === COUNCIL/CHAT VIEW === */
    .mobile-chat-container {
        display: flex;
        flex-direction: column;
        height: calc(100vh - 80px);
    }
    
    .mobile-chat-header {
        background: linear-gradient(135deg, #1c1917 0%, #0c0a09 100%);
        padding: 1.5rem 1rem;
        border-bottom: 2px solid #292524;
    }
    
    .mobile-agent-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
        margin-bottom: 1rem;
    }
    
    .mobile-agent-btn {
        background: #1c1917;
        border: 2px solid #44403c;
        border-radius: 10px;
        padding: 0.75rem 0.5rem;
        color: #78716c;
        font-size: 0.7rem;
        font-weight: 700;
        text-transform: uppercase;
        cursor: pointer;
        transition: all 0.2s;
        font-family: 'JetBrains Mono', monospace;
    }
    
    .mobile-agent-btn.active {
        background: rgba(249, 115, 22, 0.2);
        border-color: #f97316;
        color: #f97316;
    }
    
    .mobile-chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        -webkit-overflow-scrolling: touch;
    }
    
    .mobile-chat-bubble {
        max-width: 85%;
        padding: 1rem;
        border-radius: 12px;
        margin-bottom: 1rem;
        line-height: 1.6;
        font-size: 0.9rem;
    }
    
    .mobile-chat-bubble.user {
        background: #292524;
        color: #fff;
        align-self: flex-end;
        margin-left: auto;
        border: 1px solid #44403c;
    }
    
    .mobile-chat-bubble.ai {
        background: #1c1917;
        color: #d6d3d1;
        align-self: flex-start;
        border: 1px solid #44403c;
        border-left: 3px solid #f97316;
    }
    
    .mobile-chat-input-wrapper {
        padding: 1rem;
        background: #1c1917;
        border-top: 2px solid #292524;
        display: flex;
        gap: 0.75rem;
    }
    
    .mobile-chat-input {
        flex: 1;
        background: #0c0a09;
        border: 2px solid #44403c;
        border-radius: 12px;
        padding: 1rem;
        color: #fff;
        font-size: 1rem;
    }
    
    .mobile-chat-input:focus {
        outline: none;
        border-color: #f97316;
    }
    
    .mobile-chat-send {
        background: #f97316;
        border: none;
        border-radius: 12px;
        padding: 1rem 1.5rem;
        color: #fff;
        font-weight: 700;
        font-size: 0.85rem;
        cursor: pointer;
    }
    
    /* === SETTINGS VIEW === */
    .mobile-settings {
        padding: 1.5rem 1rem;
    }
    
    .mobile-settings-header {
        margin-bottom: 2rem;
    }
    
    .mobile-settings-title {
        color: #f97316;
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .mobile-settings-subtitle {
        color: #78716c;
        font-size: 0.85rem;
    }
    
    .mobile-settings-section {
        background: linear-gradient(135deg, #1c1917 0%, #292524 100%);
        border: 1px solid #44403c;
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
    
    .mobile-settings-label {
        color: #a8a29e;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        margin-bottom: 0.75rem;
        display: block;
        font-family: 'JetBrains Mono', monospace;
    }
    
    /* === EMPTY STATES === */
    .mobile-empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #78716c;
    }
    
    .mobile-empty-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 1.5rem;
        opacity: 0.3;
        stroke: currentColor;
    }
    
    .mobile-empty-title {
        font-family: 'JetBrains Mono', monospace;
        font-size: 1rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .mobile-empty-subtitle {
        font-size: 0.85rem;
        color: #57534e;
    }
    
    /* === LOADING OVERLAY === */
    .mobile-loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(12, 10, 9, 0.95);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        backdrop-filter: blur(10px);
    }
    
    .mobile-loading-text {
        color: #f97316;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.9rem;
        font-weight: 700;
        margin-top: 2rem;
        animation: glow 2s ease-in-out infinite;
    }
}
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            background: #0c0a09; 
            color: #e7e5e4; 
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1c1917; }
        ::-webkit-scrollbar-thumb { 
            background: linear-gradient(to bottom, #f97316, #ea580c); 
            border-radius: 4px; 
        }
        
        .scroll-indicator {
            position: fixed;
            top: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, #f97316, #ea580c);
            z-index: 10000;
            transition: width 0.1s;
        }
        
        .mobile-nav { display: flex !important; }
        .mobile-view { display: none; }
        .mobile-view.active { display: block; }
        .mobile-tab-content { display: none; }
        .mobile-tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="scroll-indicator" id="scrollProgress"></div>

    <div id="apex-loader">
        <div style="position: relative;">
            <div class="loader-ring-2"></div>
            <div class="loader-ring"></div>
            <div class="loader-icon">
                <svg viewBox="0 0 100 100" fill="none">
                    <path d="M50 10L20 90L50 70L80 90L50 10Z" fill="#f97316" opacity="0.9"/>
                    <path d="M50 10L20 90L50 70L80 90L50 10Z" stroke="#ea580c" stroke-width="2"/>
                    <circle cx="50" cy="50" r="3" fill="#fff"/>
                </svg>
            </div>
        </div>
        <div class="loader-text">INITIALIZING<span class="loader-dots"></span></div>
    </div>

    <div id="mobileApp">
        <div id="view-ideas" class="mobile-view active">
            <div class="mobile-ideas-header">
                <div class="mobile-ideas-title">APEX PROTOCOL</div>
                <div class="mobile-ideas-subtitle" id="ideasCount">0 OPERATIONS</div>
            </div>
            <div class="mobile-ideas-list" id="ideasList"></div>
        </div>

        <div id="view-detail" class="mobile-view">
            <div class="mobile-detail-header">
                <button class="mobile-detail-back" onclick="showView('ideas')">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                    Back
                </button>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span class="mobile-idea-rank" id="detailRank">#1</span>
                    <span class="mobile-idea-value" id="detailValue">$10M</span>
                </div>
                <div class="mobile-idea-name" id="detailName">Project</div>
                <div class="mobile-idea-tagline" id="detailTagline">Tagline</div>
            </div>
            
            <div class="mobile-detail-tabs">
                <div class="mobile-detail-tab active" onclick="showDetailTab('intel')">Intel</div>
                <div class="mobile-detail-tab" onclick="showDetailTab('blueprint')">Blueprint</div>
                <div class="mobile-detail-tab" onclick="showDetailTab('pitch')">Pitch</div>
                <div class="mobile-detail-tab" onclick="showDetailTab('council')">Council</div>
                <div class="mobile-detail-tab" onclick="showDetailTab('warroom')">War</div>
            </div>
            
            <div class="mobile-detail-content">
                <div id="tab-intel" class="mobile-tab-content active"></div>
                <div id="tab-blueprint" class="mobile-tab-content"></div>
                <div id="tab-pitch" class="mobile-tab-content">
                    <div style="padding: 1rem;">
                        <button onclick="generateMobilePitch()" class="mobile-submit-btn">Generate Pitch</button>
                        <div id="pitchContent" style="margin-top: 1.5rem;"></div>
                    </div>
                </div>
                <div id="tab-council" class="mobile-tab-content mobile-chat-container">
                    <div class="mobile-chat-header">
                        <div class="mobile-agent-grid" id="agentGrid"></div>
                    </div>
                    <div class="mobile-chat-messages" id="chatMessages"></div>
                    <div class="mobile-chat-input-wrapper">
                        <input type="text" id="chatInput" class="mobile-chat-input" placeholder="Ask..." onkeypress="if(event.key==='Enter') sendMobileChat()">
                        <button class="mobile-chat-send" onclick="sendMobileChat()">SEND</button>
                    </div>
                </div>
                <div id="tab-warroom" class="mobile-tab-content">
                    <div style="padding: 1rem;">
                        <button onclick="runMobileWarRoom()" class="mobile-submit-btn" style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);">War Games</button>
                        <div id="warRoomContent" style="margin-top: 1.5rem;"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-new" class="mobile-view">
            <div class="mobile-new-op">
                <div class="mobile-new-header">
                    <div class="mobile-new-title">New Operation</div>
                    <div class="mobile-new-subtitle">Generate startup ideas</div>
                </div>
                <form onsubmit="event.preventDefault(); runMobileOperation();">
                    <div class="mobile-form-group">
                        <label class="mobile-form-label">Domain</label>
                        <input type="text" id="newDomain" class="mobile-form-input" placeholder="AI healthcare" required>
                    </div>
                    <div class="mobile-form-group">
                        <label class="mobile-form-label">Catalyst</label>
                        <textarea id="newCatalyst" class="mobile-form-textarea" placeholder="Must use blockchain"></textarea>
                    </div>
                    <div class="mobile-form-group">
                        <label class="mobile-form-label">Risk</label>
                        <select id="newRisk" class="mobile-form-select">
                            <option value="safe">Safe</option>
                            <option value="balanced" selected>Balanced</option>
                            <option value="moonshot">Moonshot</option>
                        </select>
                    </div>
                    <button type="submit" class="mobile-submit-btn">Initialize</button>
                </form>
            </div>
        </div>

        <div id="view-settings" class="mobile-view">
            <div class="mobile-settings">
                <div class="mobile-settings-header">
                    <div class="mobile-settings-title">Settings</div>
                </div>
                <div class="mobile-settings-section">
                    <label class="mobile-settings-label">API Key</label>
                    <input type="password" id="settingsApiKey" class="mobile-form-input" placeholder="Enter API key">
                    <button onclick="saveMobileSettings()" class="mobile-submit-btn" style="margin-top: 1rem;">Save</button>
                </div>
            </div>
        </div>
    </div>

    <nav class="mobile-nav">
        <div class="mobile-nav-item active" onclick="showView('ideas')" data-view="ideas">
            <svg class="mobile-nav-icon" viewBox="0 0 24 24">
                <path d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
            </svg>
            <span class="mobile-nav-label">Ideas</span>
        </div>
        <div class="mobile-nav-item" onclick="showView('new')" data-view="new">
            <svg class="mobile-nav-icon" viewBox="0 0 24 24">
                <path d="M12 4v16m8-8H4"/>
            </svg>
            <span class="mobile-nav-label">New</span>
        </div>
        <div class="mobile-nav-item" onclick="showView('settings')" data-view="settings">
            <svg class="mobile-nav-icon" viewBox="0 0 24 24">
                <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                <circle cx="12" cy="12" r="3"/>
            </svg>
            <span class="mobile-nav-label">Settings</span>
        </div>
    </nav>

    <script type="module">
// Apex Protocol Mobile App - Complete Implementation
import { getApiUrl } from './api-config.js';

const API_BASE = getApiUrl();
const MODEL = "gemini-2.0-flash-exp";

// State
const state = {
    ideas: [],
    activeIdeaId: null,
    selectedAgent: 'ALL',
    apiKey: localStorage.getItem('apex_key') || ''
};

// Agents
const AGENTS = [
    { id: 'ALL', name: 'Council', color: '#fff' },
    { id: 'alpha', name: 'Alpha', color: '#3b82f6' },
    { id: 'beta', name: 'Beta', color: '#ef4444' },
    { id: 'gamma', name: 'Gamma', color: '#10b981' },
    { id: 'delta', name: 'Delta', color: '#f59e0b' },
    { id: 'epsilon', name: 'Epsilon', color: '#8b5cf6' }
];

// === INITIALIZATION ===
document.addEventListener('DOMContentLoaded', () => {
    console.log('ðŸš€ Apex Protocol Mobile initializing...');
    
    // Load stored data
    const stored = localStorage.getItem('apex_session');
    if (stored) {
        try {
            const data = JSON.parse(stored);
            state.ideas = data.ideas || [];
        } catch(e) {
            loadFallbackIdeas();
        }
    } else {
        loadFallbackIdeas();
    }
    
    // Setup scroll progress indicator
    setupScrollProgress();
    
    // Render initial state
    renderIdeasList();
    renderAgentGrid();
    
    // Load settings
    const apiKeyInput = document.getElementById('settingsApiKey');
    if (apiKeyInput && state.apiKey) {
        apiKeyInput.value = state.apiKey;
    }
    
    // Hide loader
    setTimeout(() => {
        const loader = document.getElementById('apex-loader');
        if (loader) {
            loader.classList.add('hidden');
            setTimeout(() => loader.style.display = 'none', 500);
        }
    }, 1500);
    
    console.log('âœ… Mobile app ready');
});

// === NAVIGATION ===
window.showView = function(viewName) {
    // Hide all views
    document.querySelectorAll('.mobile-view').forEach(v => {
        v.classList.remove('active');
    });
    
    // Show selected view
    const view = document.getElementById(`view-${viewName}`);
    if (view) {
        view.classList.add('active');
    }
    
    // Update nav
    document.querySelectorAll('.mobile-nav-item').forEach(item => {
        item.classList.remove('active');
    });
    const navItem = document.querySelector(`[data-view="${viewName}"]`);
    if (navItem) {
        navItem.classList.add('active');
    }
};

window.showDetailTab = function(tabName) {
    // Hide all tabs
    document.querySelectorAll('.mobile-tab-content').forEach(t => {
        t.style.display = 'none';
    });
    
    // Show selected tab
    const tab = document.getElementById(`tab-${tabName}`);
    if (tab) {
        tab.style.display = 'block';
    }
    
    // Update tab buttons
    document.querySelectorAll('.mobile-detail-tab').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
};

// === IDEAS LIST ===
function renderIdeasList() {
    const container = document.getElementById('ideasList');
    const countEl = document.getElementById('ideasCount');
    
    if (!container) return;
    
    countEl.textContent = `${state.ideas.length} OPERATION${state.ideas.length !== 1 ? 'S' : ''} READY`;
    
    if (state.ideas.length === 0) {
        container.innerHTML = `
            <div class="mobile-empty-state">
                <svg class="mobile-empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                </svg>
                <div class="mobile-empty-title">No Operations Generated</div>
                <div class="mobile-empty-subtitle">Tap "New" to create your first operation</div>
            </div>
        `;
        return;
    }
    
    container.innerHTML = state.ideas.map((idea, idx) => `
        <div class="mobile-idea-card" onclick="showIdea(${idea.id})">
            <div class="mobile-idea-header">
                <span class="mobile-idea-rank">#${idx + 1}</span>
                <span class="mobile-idea-value">${idea.valuation || '$10M'}</span>
            </div>
            <div class="mobile-idea-name">${idea.name}</div>
            <div class="mobile-idea-tagline">${idea.tagline}</div>
        </div>
    `).join('');
}

window.showIdea = function(id) {
    const idea = state.ideas.find(i => i.id === id);
    if (!idea) return;
    
    state.activeIdeaId = id;
    const idx = state.ideas.indexOf(idea);
    
    // Update header
    document.getElementById('detailRank').textContent = `#${idx + 1}`;
    document.getElementById('detailValue').textContent = idea.valuation || '$10M';
    document.getElementById('detailName').textContent = idea.name;
    document.getElementById('detailTagline').textContent = idea.tagline;
    
    // Render Intel tab
    renderIntelTab(idea);
    
    // Render Blueprint tab
    renderBlueprintTab(idea);
    
    // Reset other tabs
    document.getElementById('pitchContent').innerHTML = '';
    document.getElementById('chatMessages').innerHTML = `
        <div style="text-align: center; padding: 2rem; color: #78716c;">
            <p style="font-size: 0.9rem;">Council uplink active for <strong>${idea.name}</strong></p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem;">Select an agent and ask questions</p>
        </div>
    `;
    document.getElementById('warRoomContent').innerHTML = '';
    
    // Show detail view
    showView('detail');
    
    // Reset to Intel tab
    showDetailTab('intel');
};

function renderIntelTab(idea) {
    const container = document.getElementById('tab-intel');
    container.innerHTML = `
        <div style="padding: 1rem;">
            <div class="mobile-detail-section">
                <div class="mobile-detail-label" style="color: #f97316;">THE AGONY</div>
                <div class="mobile-detail-text">${idea.agony}</div>
            </div>
            
            <div class="mobile-detail-section">
                <div class="mobile-detail-label" style="color: #3b82f6;">THE SOLUTION</div>
                <div class="mobile-detail-text">${idea.solution}</div>
            </div>
            
            <div class="mobile-detail-section">
                <div class="mobile-detail-label">DEFENSIBILITY</div>
                <div class="mobile-detail-text">${idea.moat}</div>
            </div>
            
            <div class="mobile-detail-section">
                <div class="mobile-detail-label">REVENUE MODEL</div>
                <div class="mobile-detail-text">${idea.revenue}</div>
            </div>
            
            <div class="mobile-detail-section">
                <div class="mobile-detail-label">MARKET TIMING</div>
                <div class="mobile-detail-text">${idea.whynow || 'Market conditions are optimal for this venture.'}</div>
            </div>
        </div>
    `;
}

function renderBlueprintTab(idea) {
    const container = document.getElementById('tab-blueprint');
    const steps = idea.blueprint || [];
    
    container.innerHTML = `
        <div style="padding: 1rem;">
            <div style="margin-bottom: 1.5rem;">
                <div class="mobile-detail-label" style="color: #f97316; margin-bottom: 1rem;">EXECUTION ROADMAP</div>
            </div>
            ${steps.map((step, i) => `
                <div class="mobile-blueprint-item">
                    <div class="mobile-blueprint-phase">PHASE ${i + 1}</div>
                    <div class="mobile-blueprint-text">${step}</div>
                </div>
            `).join('')}
        </div>
    `;
}

// === AGENTS & CHAT ===
function renderAgentGrid() {
    const grid = document.getElementById('agentGrid');
    if (!grid) return;
    
    grid.innerHTML = AGENTS.map(agent => `
        <button 
            class="mobile-agent-btn ${agent.id === state.selectedAgent ? 'active' : ''}" 
            onclick="selectAgent('${agent.id}')"
            style="color: ${agent.id === state.selectedAgent ? agent.color : '#78716c'}">
            ${agent.name}
        </button>
    `).join('');
}

window.selectAgent = function(agentId) {
    state.selectedAgent = agentId;
    renderAgentGrid();
};

window.sendMobileChat = async function() {
    const input = document.getElementById('chatInput');
    const msg = input.value.trim();
    if (!msg) return;
    
    const messagesContainer = document.getElementById('chatMessages');
    
    // Add user message
    const userMsg = document.createElement('div');
    userMsg.className = 'mobile-chat-bubble user';
    userMsg.textContent = msg;
    messagesContainer.appendChild(userMsg);
    
    input.value = '';
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    
    if (!state.apiKey) {
        const aiMsg = document.createElement('div');
        aiMsg.className = 'mobile-chat-bubble ai';
        aiMsg.textContent = 'âš ï¸ Please configure your API key in Settings';
        messagesContainer.appendChild(aiMsg);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        return;
    }
    
    const idea = state.ideas.find(i => i.id === state.activeIdeaId);
    const agent = AGENTS.find(a => a.id === state.selectedAgent);
    
    const prompt = `
        Context: Startup "${idea.name}" - ${idea.solution}.
        You are ${agent.name} (${agent.id}). 
        User Question: "${msg}"
        Answer strictly in character. Be sharp, concise, and insightful.
    `;
    
    try {
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${state.apiKey}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
        });
        const data = await res.json();
        const reply = data.candidates[0].content.parts[0].text;
        
        const aiMsg = document.createElement('div');
        aiMsg.className = 'mobile-chat-bubble ai';
        aiMsg.innerHTML = `<strong style="color: ${agent.color}">[${agent.name}]</strong> ${reply}`;
        messagesContainer.appendChild(aiMsg);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    } catch(e) {
        const errorMsg = document.createElement('div');
        errorMsg.className = 'mobile-chat-bubble ai';
        errorMsg.textContent = 'âŒ Connection error. Check your API key.';
        messagesContainer.appendChild(errorMsg);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
};

// === PITCH GENERATION ===
window.generateMobilePitch = async function() {
    const container = document.getElementById('pitchContent');
    const idea = state.ideas.find(i => i.id === state.activeIdeaId);
    
    container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #f97316;">Generating pitch deck...</div>';
    
    try {
        const slides = await generatePitchSlides(idea);
        container.innerHTML = slides.map((slide, i) => `
            <div class="mobile-detail-section">
                <div class="mobile-detail-label" style="color: #f97316;">SLIDE ${i + 1}: ${slide.title}</div>
                <ul style="color: #d6d3d1; font-size: 0.9rem; line-height: 1.8; list-style: none; padding-left: 0;">
                    ${slide.bullets.map(b => `<li style="margin-bottom: 0.5rem;">â€¢ ${b}</li>`).join('')}
                </ul>
            </div>
        `).join('');
    } catch(e) {
        container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #ef4444;">Generation failed. Check API key.</div>';
    }
};

async function generatePitchSlides(idea) {
    if (!state.apiKey) {
        return getFallbackPitch(idea);
    }
    
    const prompt = `Create an 8-slide VC pitch deck for "${idea.name}". Solution: ${idea.solution}. Return JSON: [{"title": "...", "bullets": ["...", "..."]}]`;
    
    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${state.apiKey}`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
    });
    
    const data = await res.json();
    const txt = data.candidates[0].content.parts[0].text.replace(/```json|```/g, '').trim();
    return JSON.parse(txt);
}

function getFallbackPitch(idea) {
    return [
        {title: "The Problem", bullets: ["Market pain point is severe", "Current solutions inadequate", "Timing is perfect"]},
        {title: "The Solution", bullets: [idea.solution, "10x better than alternatives", "Scalable technology"]},
        {title: "Market Size", bullets: ["TAM: $10B", "SAM: $2B", "SOM: $500M"]},
        {title: "Business Model", bullets: [idea.revenue, "High margins", "Recurring revenue"]},
        {title: "Traction", bullets: ["Early validation", "Growing demand", "Pilot customers"]},
        {title: "Competition", bullets: [idea.moat, "Unique advantages", "Defensible position"]},
        {title: "Team", bullets: ["Expert founders", "Domain expertise", "Proven track record"]},
        {title: "The Ask", bullets: ["Raising $2M", "18-month runway", "Scale to $1M ARR"]}
    ];
}

// === WAR ROOM ===
window.runMobileWarRoom = async function() {
    const container = document.getElementById('warRoomContent');
    const idea = state.ideas.find(i => i.id === state.activeIdeaId);
    
    container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #ef4444;">Running war games...</div>';
    
    try {
        const scenarios = await generateWarScenarios(idea);
        container.innerHTML = scenarios.map(s => `
            <div class="mobile-detail-section" style="border-left: 3px solid #ef4444;">
                <div class="mobile-detail-label" style="color: #ef4444;">${s.type} THREAT</div>
                <div style="color: #fff; font-weight: 700; margin-bottom: 0.75rem; font-size: 1.1rem;">${s.title}</div>
                <div class="mobile-detail-text" style="margin-bottom: 1rem;">${s.desc}</div>
                <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 8px;">
                    <div style="color: #ef4444; font-size: 0.7rem; font-weight: 700; margin-bottom: 0.5rem;">SURVIVAL PROTOCOL</div>
                    <div style="color: #d6d3d1; font-size: 0.85rem;">${s.protocol}</div>
                </div>
            </div>
        `).join('');
    } catch(e) {
        container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #ef4444;">Failed. Check API key.</div>';
    }
};

async function generateWarScenarios(idea) {
    if (!state.apiKey) {
        return [
            {type: "COMPETITOR", title: "Big Tech Clone", desc: "Major competitor copies your feature", protocol: "Pivot to Enterprise & build moat"},
            {type: "REGULATORY", title: "New Regulations", desc: "New laws impact core business", protocol: "Lobby & geographic arbitrage"},
            {type: "TECHNICAL", title: "Scale Failure", desc: "Architecture can't handle growth", protocol: "Rebuild core systems"}
        ];
    }
    
    const prompt = `Analyze "${idea.name}": ${idea.solution}. Generate 3 threat scenarios. Return JSON: {"scenarios": [{"type": "...", "title": "...", "desc": "...", "protocol": "..."}]}`;
    
    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${state.apiKey}`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
    });
    
    const data = await res.json();
    const txt = data.candidates[0].content.parts[0].text.replace(/```json|```/g, '').trim();
    return JSON.parse(txt).scenarios;
}

// === NEW OPERATION ===
window.runMobileOperation = async function() {
    const domain = document.getElementById('newDomain').value;
    const catalyst = document.getElementById('newCatalyst').value;
    const risk = document.getElementById('newRisk').value;
    
    // Show loader
    const loader = document.getElementById('apex-loader');
    loader.classList.remove('hidden');
    loader.style.display = 'flex';
    
    try {
        const res = await fetch(API_BASE + '/ideas/generate', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ domain, catalyst, risk })
        });
        const data = await res.json();
        state.ideas = data.ideas;
        localStorage.setItem('apex_session', JSON.stringify({ideas: state.ideas}));
        renderIdeasList();
        
        setTimeout(() => {
            loader.classList.add('hidden');
            setTimeout(() => loader.style.display = 'none', 500);
            showView('ideas');
        }, 1500);
    } catch(e) {
        console.error(e);
        const ideas = getFallbackIdeas(domain);
        state.ideas = ideas;
        localStorage.setItem('apex_session', JSON.stringify({ideas}));
        renderIdeasList();
        
        setTimeout(() => {
            loader.classList.add('hidden');
            setTimeout(() => loader.style.display = 'none', 500);
            showView('ideas');
        }, 1500);
    }
};

// === SETTINGS ===
window.saveMobileSettings = function() {
    const key = document.getElementById('settingsApiKey').value;
    state.apiKey = key;
    localStorage.setItem('apex_key', key);
    
    alert('âœ… API Key saved!');
};

// === FALLBACK DATA ===
function loadFallbackIdeas() {
    state.ideas = getFallbackIdeas('General Tech');
    localStorage.setItem('apex_session', JSON.stringify({ideas: state.ideas}));
}

function getFallbackIdeas(topic) {
    return [
        {id:1, name:"AdminAI", tagline:"Life Admin Automation", valuation:"$1.2B", agony:"People waste 20hrs/mo on bills.", solution:"AI with Power of Attorney to negotiate bills.", revenue:"20% of savings.", moat:"Banking integrations.", whynow:"AI assistants mainstream.", blueprint:["Build OCR Scanner","Manual Pilot","Scale AI","Enterprise"]},
        {id:2, name:"LegacyVault", tagline:"Digital Estate Planning", valuation:"$850M", agony:"Assets lost on death.", solution:"Dead man's switch for crypto & passwords.", revenue:"Freemium model.", moat:"Security trust.", whynow:"Crypto adoption growing.", blueprint:["Vault MVP","Legal API","Insurance Partnership","Global"]},
        {id:3, name:"DeepVax", tagline:"In-Silico Drug Trials", valuation:"$4B", agony:"Drug trials too slow.", solution:"Simulate human biology for testing.", revenue:"Pharma licensing.", moat:"Data models.", whynow:"AI revolution in healthcare.", blueprint:["Train Models","Retro-Test","FDA Pilot","Scale"]},
        {id:4, name:"Fabric", tagline:"Local Manufacturing Network", valuation:"$300M", agony:"Supply chains fragile.", solution:"Network of 3D printers/makers.", revenue:"Marketplace fee.", moat:"Network density.", whynow:"Supply chain crisis.", blueprint:["Recruit Makers","Pattern Library","Consumer App","B2B"]},
        {id:5, name:"Orbit", tagline:"Third Place App", valuation:"$150M", agony:"Loneliness epidemic.", solution:"Unlocks cafe tables for meetups.", revenue:"Booking fee.", moat:"Network effects.", whynow:"Post-pandemic connection need.", blueprint:["City Pilot","Cafe Operations","Scale Cities","Membership"]}
    ];
}

// === SCROLL PROGRESS ===
function setupScrollProgress() {
    const updateScroll = () => {
        const activeView = document.querySelector('.mobile-view.active');
        if (!activeView) return;
        
        const scrollTop = activeView.scrollTop;
        const scrollHeight = activeView.scrollHeight - activeView.clientHeight;
        const progress = scrollHeight > 0 ? (scrollTop / scrollHeight) * 100 : 0;
        
        const indicator = document.getElementById('scrollProgress');
        if (indicator) {
            indicator.style.width = `${progress}%`;
        }
    };
    
    document.querySelectorAll('.mobile-view').forEach(view => {
        view.addEventListener('scroll', updateScroll);
    });
}

console.log('ðŸ“± Mobile app module loaded');
    </script>
</body>
</html>
